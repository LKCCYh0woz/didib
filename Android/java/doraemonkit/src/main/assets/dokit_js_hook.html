<script type="text/javascript">
    function generateRandom() {
      return Math.floor((1 + Math.random()) * 0x10000)
        .toString(16)
        .substring(1);
    }
    var requestID = null;
    //hook XMLHttpRequest open method
    XMLHttpRequest.prototype.reallyOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
        //console.log(url)
        requestID = generateRandom();
        var hasQuery = url.split("?")[1];
        var urlWrap = null;
        if(hasQuery){
            urlWrap = url + "&" + "dokit_flag=" + requestID
        }else{
            urlWrap = url + "?" + "dokit_flag=" + requestID
        }
        //console.log(urlWrap)
        dokitJsi.open(requestID,urlWrap,method,window.location.origin);
        this.reallyOpen(method, urlWrap, async, user, password);
    };

    //hook XMLHttpRequest setRequestHeader method
    XMLHttpRequest.prototype.reallySetRequestHeader = XMLHttpRequest.prototype.setRequestHeader;
    XMLHttpRequest.prototype.setRequestHeader = function(header, value) {
        console.log(header,value)
        dokitJsi.setRequestHeader(requestID,header,value);
        this.reallySetRequestHeader(header, value);
    };

    //hook XMLHttpRequest overrideMimeType method
    XMLHttpRequest.prototype.reallyOverrideMimeType = XMLHttpRequest.prototype.overrideMimeType;
    XMLHttpRequest.prototype.overrideMimeType = function(mimeType) {
        dokitJsi.overrideMimeType(requestID,mimeType);
        this.reallyOverrideMimeType(mimeType);
    };

    //hook XMLHttpRequest send method
    XMLHttpRequest.prototype.reallySend = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(body) {
        dokitJsi.send(requestID,body);
        //console.log(body)
        this.reallySend(body);
    };

</script>
