<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript">
    function generateRandom() {
      return Math.floor((1 + Math.random()) * 0x10000)
        .toString(16)
        .substring(1);
    }
    var requestID = null;
    //hook XMLHttpRequest open method
    XMLHttpRequest.prototype.reallyOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
        //console.log(url)
        requestID = generateRandom();
        var hasQuery = url.split("?")[1];
        var urlWrap = null;
        if(hasQuery){
            urlWrap = url + "&" + "dokit_flag=" + requestID
        }else{
            urlWrap = url + "?" + "dokit_flag=" + requestID
        }
        //console.log(urlWrap)
        dokitJsi.open(requestID,urlWrap,method,window.location.origin);
        this.reallyOpen(method, urlWrap, async, user, password);
    };

    //hook XMLHttpRequest setRequestHeader method
    XMLHttpRequest.prototype.reallySetRequestHeader = XMLHttpRequest.prototype.setRequestHeader;
    XMLHttpRequest.prototype.setRequestHeader = function(header, value) {
        console.log(header,value)
        dokitJsi.setRequestHeader(requestID,header,value);
        this.reallySetRequestHeader(header, value);
    };

    //hook XMLHttpRequest overrideMimeType method
    XMLHttpRequest.prototype.reallyOverrideMimeType = XMLHttpRequest.prototype.overrideMimeType;
    XMLHttpRequest.prototype.overrideMimeType = function(mimeType) {
        dokitJsi.overrideMimeType(requestID,mimeType);
        this.reallyOverrideMimeType(mimeType);
    };

    //hook XMLHttpRequest send method
    XMLHttpRequest.prototype.reallySend = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(body) {
        dokitJsi.send(requestID,body);
        //console.log(body)
        this.reallySend(body);
    };

    //hook Storage
    //保存一个值
    Storage.prototype.reallySetItem = Storage.prototype.setItem;
    Storage.prototype.setItem = function(key,value) {
        if(this === localStorage){
            dokitJsi.localStorageSetItem(key,value);
        }else if(this === sessionStorage){
            dokitJsi.sessionStorageSetItem(key,value);
        }
        this.reallySetItem(key,value);
    };

    //移除一个值
    Storage.prototype.reallyRemoveItem = Storage.prototype.removeItem;
    Storage.prototype.removeItem = function(key) {
        if(this === localStorage){
            dokitJsi.localStorageRemoveItem(key);
        }else if(this === sessionStorage){
            dokitJsi.sessionStorageRemoveItem(key,value);
        }

        this.reallyRemoveItem(key);
    };

    //清空
    Storage.prototype.reallyClear = Storage.prototype.clear;
    Storage.clear = function() {
        if(this === localStorage){
            dokitJsi.localStorageClear();
        }else if(this === sessionStorage){
            dokitJsi.sessionStorageClear(key,value);
        }

        this.reallyClear();
    };

    //遍历并输出localStorage里存储的名字和值
    for(var i=0; i<localStorage.length;i++){
        dokitJsi.localStorageSetItem(localStorage.key(i),localStorage.getItem(localStorage.key(i)));
    }

    //遍历并输出sessionStorage里存储的名字和值
    for(var i=0; i<sessionStorage.length;i++){
        dokitJsi.sessionStorageSetItem(sessionStorage.key(i),sessionStorage.getItem(sessionStorage.key(i)));
    }

    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本地网页测试</title>
    <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.3.4/vconsole.min.js"></script>
    <script type="text/javascript">
        var vConsole = new VConsole();
    </script>
</head>

<body>
<div>
    <button class="jquery_get">jquery get</button>
    <br/>
    <br/>
    <button class="jquery_post">jquery post</button>
    <br/>
    <br/>
    <button class="axios_get"> axios get</button>
    <br/>
    <br/>
    <button class="axios_post">axios post</button>
    <br/>
    <br/>
    <button class="add_localStorage">add localStorage</button>
    <br/>
    <br/>
    <button class="add_sessionStorage">add sessionStorage</button>
</div>


<script type="text/javascript">

		$(document).ready(function () {
		    //启动请求
//		    $.get("https://wanandroid.com/wxarticle/chapters/json", function (data, status) {
//					console.log(data);
//				});
//		    $.post("https://www.wanandroid.com/article/query/0/json", {k: "dokit"}, function (data, status) {
//					console.log(data)
//				})
		    //点击事件
			$(".jquery_get").click(function () {
				$.get("https://wanandroid.com/wxarticle/chapters/json", function (data, status) {
					console.log(data);
				});
			});

			$(".jquery_post").click(function () {
				$.post("https://www.wanandroid.com/article/query/0/json", {k: "dokit"}, function (data, status) {
					console.log(data)
				})
			});

			$(".axios_get").click(function () {
				axios.get("https://wanandroid.com/wxarticle/chapters/json")
				.then(function(response){
					console.log(response.data);
				}).catch((err) => {
					
				});

			});

			$(".axios_post").click(function () {
				axios.post("https://www.wanandroid.com/article/query/0/json","k=dokit")
				.then(function(response){
					console.log(response.data);
				}).catch((err) => {
					console.log(err)
				});
			});

			$(".add_localStorage").click(function () {
				localStorage.setItem('local', 'jintjintjintjintjintjintjintjint');
			});

			$(".add_sessionStorage").click(function () {
				sessionStorage.setItem('session', 'jintjintjintjintjintjintjintjintjint');
			});
		});
</script>
</body>

</html>